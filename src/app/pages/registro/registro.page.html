<ion-header>
  <ion-toolbar>
    <ion-title>Registro UTVCO</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-card class="register-card">
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()">

      <ion-card-header class="avatar-container">
        <div class="avatar-wrapper">
          <ion-avatar class="profile-avatar">
            <img [src]="imagePreview || 'assets/utvcoIMAGEN.jpg'" alt="Foto de perfil" />
          </ion-avatar>

          <ion-button fill="clear" class="upload-btn" (click)="fileInput.click()" size="small">
            <ion-icon name="image-outline"></ion-icon>
          </ion-button>

          <input type="file" hidden #fileInput (change)="onFileSelected($event)" accept="image/*" />
        </div>
      </ion-card-header>

      <ion-item>
        <ion-label position="floating">Nombre completo</ion-label>
        <ion-input formControlName="name" required></ion-input>
        <ion-text color="danger" *ngIf="userForm.get('name')?.invalid && userForm.get('name')?.touched">
          Nombre requerido
        </ion-text>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Correo Institucional</ion-label>
        <ion-input 
          type="email" 
          formControlName="email" 
          placeholder="matricula@utvco.edu.mx"
          required>
        </ion-input>
        <ion-text color="danger" *ngIf="userForm.get('email')?.errors?.['required'] && userForm.get('email')?.touched">
          Correo requerido
        </ion-text>
        <ion-text color="danger" *ngIf="userForm.get('email')?.errors?.['email'] && userForm.get('email')?.touched">
          Formato de correo inv√°lido
        </ion-text>
        <ion-text color="danger" *ngIf="userForm.get('email')?.errors?.['dominioInvalido'] && userForm.get('email')?.touched">
          Solo se permiten correos üåÄutvco.edu.mx
        </ion-text>
        <ion-text color="danger" *ngIf="userForm.get('email')?.errors?.['matriculaNoCoincide'] && userForm.get('email')?.touched">
          El correo debe coincidir con tu matr√≠cula (ej: TU12345üåÄutvco.edu.mx)
        </ion-text>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Contrase√±a</ion-label>
        <ion-input [type]="passwordFieldType" formControlName="password" required></ion-input>
        <ion-button fill="clear" slot="end" (click)="togglePasswordVisibility()">
          <ion-icon [name]="showPassword ? 'eye-outline' : 'eye-outline'"></ion-icon>
        </ion-button>
        <ion-text color="danger" *ngIf="userForm.get('password')?.errors?.['required'] && userForm.get('password')?.touched">
          Contrase√±a requerida
        </ion-text>
        <ion-text color="danger" *ngIf="userForm.get('password')?.errors?.['minlength'] && userForm.get('password')?.touched">
          M√≠nimo 6 caracteres
        </ion-text>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Tel√©fono</ion-label>
        <ion-input type="tel" formControlName="tel" required></ion-input>
        <ion-text color="danger" *ngIf="userForm.get('tel')?.errors?.['required'] && userForm.get('tel')?.touched">
          Tel√©fono requerido
        </ion-text>
        <ion-text color="danger" *ngIf="userForm.get('tel')?.errors?.['pattern'] && userForm.get('tel')?.touched">
          Debe tener 10 d√≠gitos
        </ion-text>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Matr√≠cula</ion-label>
        <ion-input 
          formControlName="matricula" 
          placeholder="Ej: ABC12345"
          required>
        </ion-input>
        <ion-text color="danger" *ngIf="userForm.get('matricula')?.errors?.['required'] && userForm.get('matricula')?.touched">
          Matr√≠cula requerida
        </ion-text>
        <ion-text color="danger" *ngIf="userForm.get('matricula')?.errors?.['pattern'] && userForm.get('matricula')?.touched">
          Solo caracteres alfanum√©ricos
        </ion-text>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Grupo</ion-label>
        <ion-input formControlName="grupo" required></ion-input>
        <ion-text color="danger" *ngIf="userForm.get('grupo')?.invalid && userForm.get('grupo')?.touched">
          Grupo requerido
        </ion-text>
      </ion-item>

      <ion-item lines="none">
        <ion-checkbox 
          slot="start" 
          [(ngModel)]="terminosAceptados" 
          [ngModelOptions]="{standalone: true}">
        </ion-checkbox>
        <ion-label>
          Acepto los 
          <a (click)="mostrarTerminosCondiciones()" class="terms-link">T√©rminos y Condiciones</a>
        </ion-label>
      </ion-item>

      <div class="btn-group">
        <ion-button 
          expand="block" 
          color="primary" 
          type="submit"
          [disabled]="userForm.invalid || !terminosAceptados">
          Registrar
        </ion-button>
        <ion-button 
          expand="block" 
          color="medium" 
          type="button"
          (click)="cancelarRegistro()">
          Cancelar
        </ion-button>
      </div>
    </form>
  </ion-card>

  <ion-modal [isOpen]="mostrandoTerminos" (ionModalDidDismiss)="cerrarModal()">
    <ng-template>
      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>T√©rminos y Condiciones UTVCO</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="cerrarModal()">
              <ion-icon name="close-circle" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <h2>1. Uso Institucional</h2>
        <p>Esta plataforma est√° destinada exclusivamente para uso de la comunidad UTVCO. Al registrarte, confirmas que eres estudiante, docente o personal administrativo de la instituci√≥n.</p>
        
        <h2>2. Datos Personales</h2>
        <p>El correo institucional (utvco.edu.mx) y matr√≠cula proporcionados deben ser ver√≠dicos y corresponder al usuario registrado. Cualquier falsificaci√≥n ser√° sancionada seg√∫n el reglamento escolar.</p>
        
        <h2>3. Responsabilidades</h2>
        <p>El usuario es responsable de mantener la confidencialidad de su contrase√±a y de toda actividad que ocurra bajo su cuenta.</p>
        
        <h2>4. Uso Adecuado</h2>
        <p>La plataforma debe usarse √∫nicamente para fines acad√©micos y actividades autorizadas por la instituci√≥n.</p>
        
        <div class="modal-buttons">
          <ion-button expand="block" color="primary" (click)="aceptarTerminos(); cerrarModal()">
            Aceptar T√©rminos
          </ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>